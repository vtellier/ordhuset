
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../components/oh-word.html">
<link rel="import" href="../components/oh-word-editor.html">
<link rel="import" href="../ordhuset-app/shared-style.html">


<dom-module id="list-page">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 0 8px 68px 8px;
      }
      
      .table {
        width: 100%;
      }
    </style>
    
    <firebase-query
        id="query"
        app-name="ordhuset"
        path="/words"
        data="{{data}}"
        start-at="[[startAt]]"
        end-at="[[endAt]]">
    </firebase-query>
    
    <div class$="card {{showHideList(editorOpened)}}">
      <paper-input label="Filter" value="{{startAt}}">
        <iron-icon icon="icons:search" prefix></iron-icon>
        <paper-icon-button suffix on-tap="clearFilter" icon="icons:clear" alt="clear" title="clear">
        </paper-icon-button>
      </paper-input>
      <div class$="table {{showHideList(editorOpened)}}">
        <div class=row>
          <div class="cell center">Word</div>
          <div class="cell center">Classes</div>
          <div class="cell center">Action</div>
        </div>
        <template is="dom-repeat" items="{{data}}" as="word">
          <oh-word
              word="[[word]]"
              on-edit="edit"
              on-delete="delete">
          </oh-word>
        </template>
      </div>
    </div>
    
    <oh-word-editor
        id="editor"
        word="{{editableWord}}"
        opened="{{editorOpened}}">
    </oh-word-editor>
    
    <paper-fab
        class$="{{showHideList(editorOpened)}}"
        icon="add"
        on-tap="create"
        disabled="[[!online]]"
        aria-label="Add a word">
    </paper-fab>
    
  </template>
  <script>
    Polymer({
      is: 'list-page',
      
      behaviors: [Polymer.OrdhusetBehavior],
      
      properties: {
          subroute: Object,
          data: {
            type: Object,
          },
          editableWord: {
            type: Object,
            notify: true,
            //observer: 'dataChanged'
          },
          startAt: {
            type: String,
            notify: true
          },
          endAt: {
            type: String,
            notify: true,
            computed: 'computeEndAt(startAt)',
          }
      },
      
      dataChanged: function (newData, oldData) {
        alert("data changed! " + JSON.stringify(newData) + " ; " + JSON.stringify(oldData));
      },
      
      ready: function() {
        if(this.$.query && this.$.query.refresh) {
          alert("created");
          this.$.query.refresh();
        }
      },
      
      create: function() {
        this.$.editor.open('create');
      },
      
      clearFilter: function() {
        this.startAt = '';
      },
      
      showHideList: function(show) {
        return show ? 'hidden' : '';
      },
      
      edit: function(event) {
        console.log("Gonna edit " + JSON.stringify(event.detail.word));
        this.editableWord = event.detail;
        this.$.editor.open('edit');
      },
      
      delete: function(event) {
        this.editableWord = event.detail;
        this.$.editor.delete();
      },
      
      toEditableId: function(substantiveId) {
        return this.substantivesPath + '/' + substantiveId;
      },
      
      computeEndAt: function(startAt) {
        return startAt + String.fromCharCode(-1);
      }
    });
  </script>
</dom-module>