
<link rel="import" href="../../bower_components/polymerfire/firebase-document.html">
<link rel="import" href="../../bower_components/polymerfire/firebase-query.html">
<link rel="import" href="../../bower_components/iron-flex-layout/iron-flex-layout.html">
<link rel="import" href="../../bower_components/iron-icons/iron-icons.html">
<link rel="import" href="../../bower_components/iron-icon/iron-icon.html">
<link rel="import" href="../../bower_components/paper-fab/paper-fab.html">
<link rel="import" href="../ordhuset-app/shared-style.html">


<dom-module id="list-page">
  <template>
    <style include="shared-styles">
      :host {
        display: block;
        padding: 0 8px 68px 8px;
      }

      .table {
        width: 100%;
      }
    </style>

    <firebase-query
        id="query"
        app-name="ordhuset"
        path="/norwegian"
        data="{{data}}"
        start-at="[[startAt]]"
        end-at="[[endAt]]">
    </firebase-query>

    <div class="card">
      <paper-input label="Filter" value="{{startAt}}">
        <iron-icon icon="icons:search" prefix></iron-icon>
        <paper-icon-button suffix on-tap="clearFilter" icon="icons:clear" alt="clear" title="clear">
        </paper-icon-button>
      </paper-input>
      <div class="table">
        <div class=row>
          <div class="cell center">Word</div>
          <div class="cell center">Classes</div>
          <div class="cell center">Action</div>
        </div>
        <template is="dom-repeat" items="{{data}}" as="word">
          <div class="row">
            <div class="cell">{{word.$key}}</div>
            <div class="cell">
              <template is="dom-if" if="[[word.isSubstantive]]">substantive</template>
              <template is="dom-if" if="[[word.isVerb]]">verb</template>
              <template is="dom-if" if="[[word.isAdjective]]">adjective</template>
            </div>
            <div class="cell center">
              <paper-icon-button
                  icon="icons:cancel"
                  title="remove"
                  on-tap="delete">
              </paper-icon-button>
              <a href="[[subroute.prefix]]edit/[[word.$key]]">
                <paper-icon-button
                    icon="icons:create"
                    title="Edit the word [[word.$key]]">
                </paper-icon-button>
              </a>
            </div>
          </div>
        </template>
      </div>
    </div>

    <a href="[[stripLastSlash(subroute.prefix)]]edit" title="Add a new word">
      <paper-fab
          class="button-box"
          icon="add"
          on-tap=""
          disabled="[[!online]]"
          aria-label="Add a word">
      </paper-fab>
    </a>
  </template>
  <script>
    Polymer({
      is: 'list-page',

      behaviors: [Polymer.OrdhusetBehavior],

      properties: {
          subroute: {
            type: Object,
            observer: 'onSubrouteChanged'
          },
          data: {
            type: Object,
          },
          startAt: {
            type: String,
            notify: true
          },
          endAt: {
            type: String,
            notify: true,
            computed: 'computeEndAt(startAt)',
          }
      },

      dataChanged: function (newData, oldData) {
        console.log("data changed! " + JSON.stringify(newData) + " ; " + JSON.stringify(oldData));
      },

      onSubrouteChanged: function (newData, oldData) {
        console.log("onSubrouteChanged\nnew: " + JSON.stringify(newData) + "\nold:" + JSON.stringify(oldData));
      },
/*
      create: function() {
        this.$.editor.create();
      },
*/
      clearFilter: function() {
        this.startAt = '';
      },
/*
      edit: function(event) {
        var model = event.model;
        this.$.editor.edit(model.word.$key);
      },
*/
      delete: function(event) {
        console.warn("Not implemented");
      },

      computeEndAt: function(startAt) {
        return startAt + String.fromCharCode(-1);
      }
    });
  </script>
</dom-module>