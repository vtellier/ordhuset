
<link rel="import" href="oh-style.html">
<link rel="import" href="../../bower_components/neon-animation/web-animations.html">
<link rel="import" href="../../bower_components/paper-dropdown-menu/paper-dropdown-menu.html">
<link rel="import" href="../../bower_components/paper-listbox/paper-listbox.html">
<link rel="import" href="../../bower_components/paper-item/paper-item.html">
<link rel="import" href="oh-definition.html">

<dom-module id="pg-my-list">
  <template>
    <style include="oh-style">
      .add-something {
        @apply --layout-horizontal;
        @apply --layout-wrap;
      }
      .add-something * {
        margin: 0 1ex;
      }
    </style>

    <app-route
      route="{{route}}"
      pattern="/:word/:def"
      data="{{routeData}}"
      tail="{{subroute}}">
    </app-route>
    
    <firebase-document
      id="userDocument"
      path="/users/{{user.uid}}"
      data="{{__userEntity}}">
    </firebase-document>

    <h1>[[localize('app-shell.menu.MyList')]]</h1>
    Under construction.
    <template is="dom-repeat" items="{{__userEntity.list}}">
      [[stringify(item)]]
    </template>

  </template>

  <script>
    class PgMyList extends LocalizationMixin(OhUtils(Polymer.Element)) {

      static get is() { return 'pg-my-list'; }

      static get properties() {
        return {
          route: {
            type: Object
          }
        }
      }

      static get observers() {
        return [
          '__observerUserEntity(__userEntity, user)'
          ];
      }

      __observerUserEntity(entity, user) {
        if(!entity || !user)
          return;

        // Create the list the first time
        if(!entity.hasOwnProperty('list')) {
          var path = `/users/${this.user.uid}/list`;
          console.log(path);
          this.$.userDocument.saveValue(path, [])
            .then(()=>{
              console.log(`User successfully saved`);
            })
            .catch((e)=>{
              console.error(`Unable to save user`, e);
            });
        }
      }
      
    }

    // Register the x-custom element with the browser
    customElements.define(PgMyList.is, PgMyList);
  </script>

</dom-module>
