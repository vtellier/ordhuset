<link rel="import" href="../../bower_components/app-storage/app-network-status-behavior.html">
<script>
  (function() {
    'use strict';
    Polymer.OrdhusetBehaviorImpl = {
      properties: {
        editableSubstantiveId: {
          type: String,
          notify: true
        }
      },
      get substantivesPath() {
        return '/substantives/';
      },
      toEditableSubstantiveId: function(substantiveId) {
        return substantiveId;
      },
      edit: function(event) {
        var substantiveElement = Polymer.dom(event).localTarget;
        this.editableSubstantiveId = this.toEditableId(substantiveElement.id);
        this.$.document.transactionsComplete.then(function() {
          this.$.editor.open(substantiveElement);
        }.bind(this));
      },
      commitChange: function(event) {
        var changeCommits;
        switch (event.detail) {
          case 'save':
            changeCommits = this.save();
            break;
          case 'delete':
            changeCommits = this.delete(event.detail);
            break;
          case 'cancel':
            changeCommits = this.cancel();
            break;
          default:
            changeCommits = Promise.resolve();
            break;
        }
        if (this.$.query && this.$.query.refresh) {
          changeCommits.then(function() {
            this.$.query.refresh();
          }.bind(this));
        }
      },
      
      // todo remove
      save: function() {
        if (this.$.document.isNew &&
            (this.editableSubstantive.english ||
             this.editableSubstantive.norwegian)) {
          return this.$.document.save(this.substantivesPath, this.editableSubstantive.norwegian).then(function() {
            this.$.document.reset();
          }.bind(this));
        }
        return Promise.resolve();
      },
      delete: function(word) {
        this.editableSubstantiveId = this.substantivesPath + word.norwgian;
        alert(JSON.stringify(word));
        if (word && !this.$.document.isNew) {
          this.$.document.destroy();
        }
        return Promise.resolve();
      },
      cancel: function() {
        if(this.editableSubstantive.english ||
           this.editableSubstantive.norwegian){
          this.editableSubstantive = null;
        }
        return Promise.resolve();
      },
      signOut: function() {
        if (this.$.auth) {
          this.$.auth.signOut();
        }
      }
    };
    /** @polymerBehavior */
    Polymer.OrdhusetBehavior = [
      Polymer.AppNetworkStatusBehavior,
      Polymer.OrdhusetBehaviorImpl
    ];
  })();
</script>